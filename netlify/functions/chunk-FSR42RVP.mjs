import './polyfills.server.mjs';
import{c as T}from"./chunk-P3WYHYUZ.mjs";import{a as _,b as g,c as p,f as m,j as w,n as H}from"./chunk-SK7OS3S2.mjs";var R=m(a=>{"use strict";var Y=a&&a.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Z=a&&a.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),I=a&&a.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Y(t,e,r);return Z(t,e),t};Object.defineProperty(a,"__esModule",{value:!0});a.req=a.json=a.toBuffer=void 0;var ee=I(p("http")),te=I(p("https"));function L(e){return w(this,null,function*(){let t=0,r=[];try{for(var n=H(e),o,s,c;o=!(s=yield n.next()).done;o=!1){let u=s.value;t+=u.length,r.push(u)}}catch{c=[s]}finally{try{o&&(s=n.return)&&(yield s.call(n))}finally{if(c)throw c[0]}}return Buffer.concat(r,t)})}a.toBuffer=L;function re(e){return w(this,null,function*(){let r=(yield L(e)).toString("utf8");try{return JSON.parse(r)}catch(n){let o=n;throw o.message+=` (input: ${r})`,o}})}a.json=re;function ne(e,t={}){let n=((typeof e=="string"?e:e.href).startsWith("https:")?te:ee).request(e,t),o=new Promise((s,c)=>{n.once("response",s).once("error",c).end()});return n.then=o.then.bind(o),n}a.req=ne});var J=m(f=>{"use strict";var U=f&&f.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),oe=f&&f.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),z=f&&f.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&U(t,e,r);return oe(t,e),t},se=f&&f.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&U(t,e,r)};Object.defineProperty(f,"__esModule",{value:!0});f.Agent=void 0;var ie=z(p("net")),k=z(p("http")),ce=p("https");se(R(),f);var d=Symbol("AgentBaseInternalState"),$=class extends k.Agent{constructor(t){super(t),this[d]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}let{stack:r}=new Error;return typeof r!="string"?!1:r.split(`
`).some(n=>n.indexOf("(https.js:")!==-1||n.indexOf("node:https:")!==-1)}incrementSockets(t){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[t]||(this.sockets[t]=[]);let r=new ie.Socket({writable:!1});return this.sockets[t].push(r),this.totalSocketCount++,r}decrementSockets(t,r){if(!this.sockets[t]||r===null)return;let n=this.sockets[t],o=n.indexOf(r);o!==-1&&(n.splice(o,1),this.totalSocketCount--,n.length===0&&delete this.sockets[t])}getName(t){return(typeof t.secureEndpoint=="boolean"?t.secureEndpoint:this.isSecureEndpoint(t))?ce.Agent.prototype.getName.call(this,t):super.getName(t)}createSocket(t,r,n){let o=g(_({},r),{secureEndpoint:this.isSecureEndpoint(r)}),s=this.getName(o),c=this.incrementSockets(s);Promise.resolve().then(()=>this.connect(t,o)).then(u=>{if(this.decrementSockets(s,c),u instanceof k.Agent)try{return u.addRequest(t,o)}catch(y){return n(y)}this[d].currentSocket=u,super.createSocket(t,r,n)},u=>{this.decrementSockets(s,c),n(u)})}createConnection(){let t=this[d].currentSocket;if(this[d].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[d].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[d]&&(this[d].defaultPort=t)}get protocol(){return this[d].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[d]&&(this[d].protocol=t)}};f.Agent=$});var K=m(b=>{"use strict";var ue=b&&b.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(b,"__esModule",{value:!0});b.parseProxyResponse=void 0;var ae=ue(T()),x=(0,ae.default)("https-proxy-agent:parse-proxy-response");function fe(e){return new Promise((t,r)=>{let n=0,o=[];function s(){let l=e.read();l?N(l):e.once("readable",s)}function c(){e.removeListener("end",u),e.removeListener("error",y),e.removeListener("readable",s)}function u(){c(),x("onend"),r(new Error("Proxy connection ended before receiving CONNECT response"))}function y(l){c(),x("onerror %o",l),r(l)}function N(l){o.push(l),n+=l.length;let v=Buffer.concat(o,n),O=v.indexOf(`\r
\r
`);if(O===-1){x("have not received end of HTTP headers yet..."),s();return}let i=v.slice(0,O).toString("ascii").split(`\r
`),A=i.shift();if(!A)return e.destroy(),r(new Error("No header received from proxy CONNECT response"));let D=A.split(" "),V=+D[1],X=D.slice(2).join(" "),P={};for(let S of i){if(!S)continue;let M=S.indexOf(":");if(M===-1)return e.destroy(),r(new Error(`Invalid header from proxy CONNECT response: "${S}"`));let q=S.slice(0,M).toLowerCase(),B=S.slice(M+1).trimStart(),E=P[q];typeof E=="string"?P[q]=[E,B]:Array.isArray(E)?E.push(B):P[q]=B}x("got proxy server response: %o %o",A,P),c(),t({connect:{statusCode:V,statusText:X,headers:P},buffered:v})}e.on("error",y),e.on("end",u),s()})}b.parseProxyResponse=fe});var Oe=m(h=>{var le=h&&h.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),he=h&&h.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),G=h&&h.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&le(t,e,r);return he(t,e),t},Q=h&&h.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(h,"__esModule",{value:!0});h.HttpsProxyAgent=void 0;var j=G(p("net")),W=G(p("tls")),de=Q(p("assert")),pe=Q(T()),ye=J(),_e=p("url"),ge=K(),C=(0,pe.default)("https-proxy-agent"),be=(()=>{class e extends ye.Agent{constructor(r,n){super(n),this.options={path:void 0},this.proxy=typeof r=="string"?new _e.URL(r):r,this.proxyHeaders=n?.headers??{},C("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let o=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),s=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts=g(_({ALPNProtocols:["http/1.1"]},n?F(n,"headers"):null),{host:o,port:s})}connect(r,n){return w(this,null,function*(){let{proxy:o}=this;if(!n.host)throw new TypeError('No "host" provided');let s;if(o.protocol==="https:"){C("Creating `tls.Socket`: %o",this.connectOpts);let i=this.connectOpts.servername||this.connectOpts.host;s=W.connect(g(_({},this.connectOpts),{servername:i&&j.isIP(i)?void 0:i}))}else C("Creating `net.Socket`: %o",this.connectOpts),s=j.connect(this.connectOpts);let c=typeof this.proxyHeaders=="function"?this.proxyHeaders():_({},this.proxyHeaders),u=j.isIPv6(n.host)?`[${n.host}]`:n.host,y=`CONNECT ${u}:${n.port} HTTP/1.1\r
`;if(o.username||o.password){let i=`${decodeURIComponent(o.username)}:${decodeURIComponent(o.password)}`;c["Proxy-Authorization"]=`Basic ${Buffer.from(i).toString("base64")}`}c.Host=`${u}:${n.port}`,c["Proxy-Connection"]||(c["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let i of Object.keys(c))y+=`${i}: ${c[i]}\r
`;let N=(0,ge.parseProxyResponse)(s);s.write(`${y}\r
`);let{connect:l,buffered:v}=yield N;if(r.emit("proxyConnect",l),this.emit("proxyConnect",l,r),l.statusCode===200){if(r.once("socket",ve),n.secureEndpoint){C("Upgrading socket connection to TLS");let i=n.servername||n.host;return W.connect(g(_({},F(n,"host","path","port")),{socket:s,servername:j.isIP(i)?void 0:i}))}return s}s.destroy();let O=new j.Socket({writable:!1});return O.readable=!0,r.once("socket",i=>{C("Replaying proxy buffer for failed request"),(0,de.default)(i.listenerCount("data")>0),i.push(v),i.push(null)}),O})}}return e.protocols=["http","https"],e})();h.HttpsProxyAgent=be;function ve(e){e.resume()}function F(e,...t){let r={},n;for(n in e)t.includes(n)||(r[n]=e[n]);return r}});export default Oe();
